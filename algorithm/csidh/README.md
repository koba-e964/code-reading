# CSIDH の基礎

主に [[CLMPR2018]] の流れに沿ってまとめる。また数式処理のために SageMath を使う。バージョンは 10.4 である。

```sage
sage: version()
'SageMath version 10.4, Release Date: 2024-07-19'
```

## 単語の定義
### 代数体の整数環
代数体 $K$ に対する**整数環** (the *ring of integers*) $\mathbb{Z}_K$ は、モニック有理整数係数多項式の根であるような $K$ の元を集めた集合に環の構造を入れたものである。

例えば $K = \mathbb{Q}(\sqrt{5})$ とすると、 $(1+\sqrt{5})/2$ は $x^2-x-1$ の根であるため、 $\mathbb{Z}_K$ の要素である。 (つまり $\mathbb{Z}_K \neq \mathbb{Z}[\sqrt{5}]$)

体が与えられた時それの整数環を決定する (有限生成アーベル群としての生成元を求める) のは一般には自明ではない [[Kid2004]]。

### 整環 (オーダー)
**整環** (**オーダー**, *order*) とは簡単には ($\mathbb{Z}$ を含む) 代数体の整数環の指数有限の部分群のこと。例えば体 $\mathbb{Q}(i)$ に対する環 $\mathbb{Z}[i] = \mathbb{Z}_{\mathbb{Q}(i)}$ や $\mathbb{Z}[3i]$ は整環だが、 $\mathbb{Z}$ などはそうではない。

### 導手
整環 (オーダー) の**導手** (*conductor*) とは、整数環 (極大な整環) の (加法に関する) 部分群として見た時の指数のことを指す。
例えば $\mathbb{Z}[2i]$ の導手は 2 である。


## 整環 (オーダー) におけるイデアル類群について (Section 2)
$R_1 = \mathbb{Z}[(1+\sqrt{-83})/2]$ と $R_2 = \mathbb{Z}[\sqrt{-83}]$ において、 $\pi = \sqrt{-83}$ としたときの $I = (3, \pi - 1)$ の挙動を見よう [[CLMPR2018], Figure 2]。 $R_1$ は $\mathbb{Q}(\sqrt{-83})$ の整数環だが、 $R_2$ は導手 2 の整環 (オーダー) であることに注意。

$$I^2 = (9, -3+3\pi, -82-2\pi) = (9, -1-2\pi)$$

$$I^3 = (27, -3-6\pi, -9+9\pi, 167+\pi) = (27, 5+\pi)$$

ここで、 $R_1$ において $(5+\pi)/2$ が要素に含まれており、なおかつ $27 = ((5+\pi)/2)((5-\pi)/2), 5+\pi = (5+\pi)/2 \cdot 2$ が成り立つため、 $I^3$ は単項生成イデアルであるが、 $R_2$ においてはそうではないことに注意。

SageMath で計算すると以下のようになる。

```sage
sage: x = polygen(ZZ, 'x')
sage: K.<pi> = NumberField(x^2+83); R1 = K.order((1+pi)/2); R2 = K.order(pi)
sage: R1
Maximal Order generated by 1/2*pi + 1/2 in Number Field in pi with defining polynomial x^2 + 83
sage: R2
Order of conductor 2 generated by pi in Number Field in pi with defining polynomial x^2 + 83
sage: R1.discriminant()
-83
sage: R2.discriminant()
-332
sage: R2.index_in(R1)
2
sage: pi**2
-83
sage: I1 = R1.ideal([3, pi-1])
sage: I1
Fractional ideal (3, 1/2*pi - 1/2)
sage: I1^2
Fractional ideal (9, 1/2*pi + 5/2)
sage: I1^3
Fractional ideal (1/2*pi + 5/2)
sage: I2 = R2.ideal([3, pi-1])
sage: I2
Ideal (2*pi + 1, 3*pi) of Order of conductor 2 generated by pi in Number Field in pi with defining polynomial x^2 + 83
sage: I2^2
Ideal (2*pi + 1, 9*pi) of Order of conductor 2 generated by pi in Number Field in pi with defining polynomial x^2 + 83
sage: I2^3
Ideal (11*pi + 1, 27*pi) of Order of conductor 2 generated by pi in Number Field in pi with defining polynomial x^2 + 83
sage: I2^9
Ideal (15887*pi + 1, 19683*pi) of Order of conductor 2 generated by pi in Number Field in pi with defining polynomial x^2 + 83
sage: ((5+pi)/2) ** 3
-pi - 140
sage: R2.ideal(-pi-140)
Ideal (15887*pi + 1, 19683*pi) of Order of conductor 2 generated by pi in Number Field in pi with defining polynomial x^2 + 83
sage: I2^9 == R2.ideal(-pi-140)
True
sage: R1.class_number()
3
sage: R2.class_number()
9
```

なお、conductor > 1 な整環だと必ずしも全てのイデアルが cancellable ではないので、注意すること。例えば $R_2$ において $I = (2,1+\pi)$ とおくと $I \neq (2)$ だが $I^2 = 2I$ である。cancellable なイデアルだけを議論に乗せることでイデアル類「群」が考えられる。

```sage
sage: I = R2.ideal([2,1+pi])
sage: I != R2.ideal([2])
True
sage: I ** 2 == 2 * I
True
```

## イデアル類群の楕円曲線に対する作用について (Section 3)
csidh.sage で実験できる。

```
$ sage csidh.sage
0 Elliptic Curve defined by y^2 = x^3 + x over Finite Field of size 83
1 Elliptic Curve defined by y^2 = x^3 + 72*x^2 + x over Finite Field of size 83
2 Elliptic Curve defined by y^2 = x^3 + 71*x^2 + x over Finite Field of size 83
3 Elliptic Curve defined by y^2 = x^3 + 77*x^2 + x over Finite Field of size 83
4 Elliptic Curve defined by y^2 = x^3 + 13*x^2 + x over Finite Field of size 83
5 Elliptic Curve defined by y^2 = x^3 + 70*x^2 + x over Finite Field of size 83
6 Elliptic Curve defined by y^2 = x^3 + 6*x^2 + x over Finite Field of size 83
7 Elliptic Curve defined by y^2 = x^3 + 12*x^2 + x over Finite Field of size 83
8 Elliptic Curve defined by y^2 = x^3 + 11*x^2 + x over Finite Field of size 83
```

# 量子計算機による攻撃
Grover's algorithm を使って $O(\sqrt[6]{p})$-time。
## 疑問点
### 1
有限体上の楕円曲線は常に Montgomery 曲線として表せる (同型な Montgomery 曲線が存在する) のか?

一般の楕円曲線では不可能。 (例えば $y^2 = f(x)$ において f に根がない場合位数 2 の元が存在しないが、Montgomery 曲線は位数 2 の点 (0,0) を持つ。)

以下のような前提条件があればできるはず。
- $p \equiv 3 \pmod{8}$
- $E$ は supersingular である。
- $E[2] \simeq \mathbb{Z}/2$ である。つまり位数 2 の点は (3 個ではなく) 1 個である。
- $\mathrm{End}(E) = \mathbb{Z}[\pi]$ (上と同値)

この条件を満たすと以下のようなボーナスがつく。

- $y^2 = x^3 + Ax^2 + x$ を楕円曲線の式としたとき、 $(A^2-4) \bmod p$ は平方非剰余である。

### 2
量子計算機による攻撃に対して、どの程度の計算量を要求すればいいのか?

### 3
claw finding から Grover への帰着は?

多分無理。少なくとも [[Tan2008]] ではやっていない。

# 参考文献
[[CLMPR2018]] Castryck, Wouter, et al. "CSIDH: an efficient post-quantum commutative group action." Advances in Cryptology–ASIACRYPT 2018: 24th International Conference on the Theory and Application of Cryptology and Information Security, Brisbane, QLD, Australia, December 2–6, 2018, Proceedings, Part III 24. Springer International Publishing, 2018.

[[Kid2004]] 木田 祐司. "代数体の整数基底と素数の素イデアル分解." 2004.

[CLMPR2018]: https://csidh.isogeny.org/csidh-20181118.pdf

[JF2011]: https://eprint.iacr.org/archive/2011/506/20110918:024142

[Kid2004]: https://web.archive.org/web/20130228161813/http://www.rkmath.rikkyo.ac.jp/~kida/intbasis.pdf

[Tan2008]: https://arxiv.org/abs/0708.2584
